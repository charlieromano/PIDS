La red TCN

La red de comunicaciones del tren (TCN) presenta una arquitecura de buses jerárquicos de dos niveles: el bus de datos WTB y el MVB [IEC-61375,1999]. El WTB se encarga de las comunicaciones entre coches a través de nodos con redundancia física, mientras que al bus MVB se conectan los dispositivos de cada coche. Algunos de estos dispositivos son el control de puertas (DOORL/R), el aire acondicionado (HVAC), el sistema de tracción (VVVF), el sistema de control de frenos (BCU), los mapas de recorrido y los carteles de matriz LED, entre otros. El mapa y los carteles LED en conjunto con otros dispositivos como los parlantes y las cámaras de video (CCTV) forman un subsistema denominado Sistema de información al pasajero (PIDS).

El sistema PIDS de las formaciones de Trenes Argentinos (SOFSE) adquiridas en 2015 tiene una arquitectura propietaria que usa una red RS485 con protocolos. Cabe mencionar que desde 2008 [feng2016] la IEC busca desarrollar estándares para TCN usando redes Ethernet de tiempo real. En 2016 se publica  IEC62580-2 que incluye al sistema de información al pasajero (ahora llamado PIS) y el CCTV en el estándar. Sin embargo, este nuevo estándar no estaría disponible en dispositivos comerciales hasta finales de 2016/2017. Para el personal de SOFSE el estudio y desarrollo de herramientas de mantenimiento para la red PIDS existente es de gran relevancia porque permite extender la vida útil de los trenes, planificada en no menos de 20 años. En este trabajo se estudia entonces el sistema PIDS basado en redes RS485 con protocolos. 

El sistema PIDS se detalla en la figura y en la misma se pueden observar diversos flujos de datos. En la cabina del conductor hay un micrófono (MIC) y un parlante (LSP_C) que se conectan a una unidad de operación (DACU). El conductor puede cambiar el mensaje del cartel led frontal del tren (FDU) para indicar el destino del recorrido. Tanto la DACU como el FDU se conectan a un bus de datos RS485 que lo comunica con dos módulos concentradores: el controlador del sistema de broadcast (PCU) y la unidad de control de salón (SCU). A la PCU se conectan las cámaras de video de la cabina y la cabina trasera (CAM_C, CAM_T), un display led táctil (TLCD) que permite al conductor visualizar el estado del tren y una interfaz con la red TCN (TCMS). A la SCU se conectan las cámaras de salón (CAM1, CAM2), los parlantes (LSP) que permiten enviar mensajes de audio a los pasajeros, las alarmas de emergencia (PECU_1, PECU_2), los mapas LED que permiten ver el estado del recorrido arriba de cada puerta (LDMU1-LDMU6) y los carteles de matriz LED de salón (IDU1, IDU2). El desarrollo de piezas de software y hardware de este trabajo se centra en estas últimas piezas de control denominadas IDU.

El equipamiento electrónico existente del tren se compone de distintos módulos que se alojan en los racks de salón (ver fotografía). En el rack de cabina se pueden observar las unidades negras ( AXMe, ERMe, DMe, DIM1, DIM2, REP, GWMe, RCMe) en la parte superior que se vinculan directamente con los bloques del diagrama de la red TCN, y las unidades grises (Power, PISC, DMS, EPS, IPC IO) en la parte inferior que se vinculan con el diagrama de la red PIDS. En cada rack de salón también se pueden encontrar las unidades Power, AMP, LCU, SAPU, SW, IPC IO que se vinculan con el bloque SCU de la red PIDS. 

Al módulo SCU se conectan buses de datos usando un conector Harting de 48 pines. Los cables que llegan al conector están nomenclados tal como indica el plano de la red PIDS: los cables 4001, 4002 y 4003 vinculan el SCU con la DACU hacia la izquierda y los otros salones hacia la derecha; los cables 4330 y 4430 conectan en serie o guirnalda de los carteles de matriz led IDU1, los mapas LDMU2, LDMU4, LDMU6 y LDMU1, LDMU3, LDMU5, IDU2 respectivamente; los cables 4510 y 4610 conectan los parlantes de salón. Para estudiar la comunicación entre estos buses de datos se ha contruido una pieza de hardware que sirve como punto de prueba o capturador de paquetes de red RS485. En la siguiente imagen se puede obervar la conexión en serie realizada en las formaciones de SOFSE.

Este sniffer para red RS485 compatible con el cableado del SCU permitió capturar tramas de datos en vivo en el tren usando una conexión serie-USB con una laptop. Estas tramas de datos se estudiaron posteriormente logrando identificar algunos patrones. Los puntos de medición buscan identificar la comunicación entre los carteles de matriz led y el resto del sistema. Siguiendo el cableado hasta el cartel se pudo estudiar el IDU como un conjunto entre un transceiver y un driver LED. El transceiver es una placa de control que se muestra en la figura ... y que va instalada dentro del gabinete del cartel led. 

Esta placa se alimenta con 110 VDC, recive las señales de la red RS485, tiene bloques de conversión DC-DC a 5 y 3 Volt para alimentar un microcontrolador NXPLPC4337 y comunica mensajes al cartel LED a través de un conector 2x8 de salida. 

La salida de esta placa se conecta con la placa de control del cartel de matriz LED. Esta placa de control usa un conjunto de chips digitales (74HC245, 74HC595, 74HC138) que permite enviar datos a las matrices LED siguiendo una lógica de control muy eficiente. Las señales enviadas desde el microcontrolador permiten enviar los datos para todas las matrices usando sólo 3 señales: CLK, STR y LATCH. Usando la señal STR se envían datos a las matrices en datos de 8 bits, cada dato corresponde a una matriz. La señal de clk y latch permiten que los datos se propaguen en las entradas y salidas de los registros de desplazamiento de los chips 74HC595. Este tipo de conexión se conoce como 

Diagramas, esquemáticos, Circuitos eléctricos, fotos

El sistema embebido desarrollado, su arquitectura y lógica de uso.


[feng2016] : Survey 
